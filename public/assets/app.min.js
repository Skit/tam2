$(function(){}),window.onload=function(){};
!function(t){function e(t,e){return e?("object"!=typeof e&&(e=[e]),e.forEach(function(e){t=t.replace(/%[\w]*/,e)}),t):t}var s={errorClass:"ui-state-error",highLightClass:"ui-state-highlight",defaultTypeText:"All form fields are required.",tips:".validateTips"},n={init:function(e){return settings=t.extend({},s,e),settings},checkLength:function(e){settings=t.extend({min:3,max:15,smsReplaceMin:"Length of %name must be minimum %min ",smsReplaceMinMax:"Length of %name must be between %min and %max."},s,e);var i=settings.objEl.val().length;return 0!=settings.max||i==settings.min?!(i>settings.max||i<settings.min)||0==settings.max||(settings.objEl.addClass(settings.errorClass),n.updateTips(settings.smsReplaceMinMax,[settings.name,settings.min,settings.max]),!1):(settings.objEl.addClass(settings.errorClass),void n.updateTips(settings.smsReplaceMin,[settings.nameEl,settings.min]))},checkSelect:function(e){return settings=t.extend({smsReplace:'Please select "%name" option'},s,e),!!settings.objEl.val()||(settings.objEl.addClass(settings.errorClass),n.updateTips(settings.smsReplace,settings.nameEl),!1)},checkRegexp:function(e){return settings=t.extend({},s,e),!!settings.pattern.test(settings.objEl.val())||(settings.objEl.addClass(e.errorClass),n.updateTips(settings.sms),!1)},equalOrLaterDate:function(e){settings=t.extend({sms:"Later than or equal current date must be"},s,e);var i=settings.objEl.val();i=i.match(settings.patternDate);var a=new Date,r=i[3],l=i[2]-1,g=i[1],o=a.getHours(),u=a.getMinutes(),p=a.getSeconds(),d=a.getMilliseconds(),m=new Date(r,l,g,o,u,p,d).valueOf();return a-m<=0||(settings.objEl.addClass(settings.errorClass),n.updateTips(settings.sms),!1)},tipsField:function(e,n){settings=t.extend({},s,e);var i=t(settings.tips);return n===!0?i=i.text(settings.defaultTypeText):n===!1&&(i=i.text()),i},updateTips:function(s,i){if(settings.tips){var a=n.tipsField({tips:settings.tips}),r=e(s,i);n.tipsField({defaultTypeText:r},!0),a.addClass(settings.highLightClass),setTimeout(function(){a.removeClass(settings.highLightClass,1500)},500)}else t.error("You must set element for show validation message in settings plugin")}};t.fn.validatorMe=function(e){return n[e]?n[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void t.error("Метод с именем "+e+" не существует для jQuery.validatorMe"):n.init.apply(this,arguments)}}(jQuery);
!function(e){var s={successScore:3e3,successClass:"ui-state-highlight ui-corner-all",successText:"Succes",errorScore:3e3,errorClass:"ui-state-error ui-corner-all",errorText:"Error",loaderEl:"#loader",informEl:"#inform",method:"POST",type:"json",async:!0,data:{}},r={init:function(r){var a=e.extend({},s,r),o=e(a.informEl);loader=e(a.loaderEl).show();var t=e.ajax({url:a.url,method:a.method,dataType:a.type,data:a.data,async:a.async,success:function(){o.is(":visible")||o.show(),o.addClass(a.successClass).text(a.successText),o.hide(a.successScore,"swing",function(){o.removeClass(a.successClass)})},error:function(){o.is(":visible")||o.show(),o.addClass(a.errorClass).text(a.errorText),o.hide(a.errorScore,"swing",function(){o.removeClass(a.errorClass)})}});return loader.hide(),a.async?"async":t.status}};e.fn.ajaxReq=function(s){return r[s]?r[s].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof s&&s?void e.error("Метод с именем "+s+" не существует для jQuery.ajaxReq"):r.init.apply(this,arguments)}}(jQuery);
$(function(){function e(e,s,t){return $(this).ajaxReq({url:s,async:!1,data:{id:e},successText:t.success,errorText:t.error})}$("a.del").on("click",function(s){s.preventDefault();var t=$(this).closest("tr"),a={delClass:"redElement",taskId:t.data("task-id"),taskName:t.children("td:nth-child(2)").text(),postUrl:"/del",messages:{success:"Success",error:"Error"}};return t.addClass(a.delClass),$("#taskName").text(a.taskName),$("#dialog-delete").dialog({modal:!0,buttons:{Cancel:function(){$(this).dialog("close")},Delete:function(){200==e(a.taskId,a.postUrl,a.messages)&&t.remove(),$(this).dialog("close")}},close:function(e,s){t.removeClass(a.delClass)}}),!1})});
!function(t){var e={elements:{}},i={init:function(i){settings=t.extend({},e,i);var n="<tr class='ui-state-disabled'><td><span class=\"ui-icon ui-icon-arrowthick-2-n-s\"></span></td>",s="";bottom='<td><a class="del" href=""><span class="ui-state-default ui-state-error ui-corner-all ui-icon ui-icon-closethick"></span></a>  | <a class="edit" href=""><span class="ui-state-default ui-corner-all ui-icon ui-icon-pencil"></span></a></td></tr>';for(el in settings.elements)s+="<td>"+settings.elements[el]+"</td>";return n+s+bottom}};t.fn.createElementTable=function(e){return i[e]?i[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void t.error("Метод с именем "+e+" не существует для jQuery.createElementTable"):i.init.apply(this,arguments)}}(jQuery);
!function(e){function t(t,a,o){var r=!0,n=e("#name",creUpDialog),c=e("#priority",creUpDialog),d=e("#state",creUpDialog),s=e("#datepickerDialog",creUpDialog),r=r&&e(this).validatorMe("checkLength",{objEl:n,nameEl:"Name",max:100});r=r&&e(this).validatorMe("checkSelect",{objEl:c,nameEl:"Priority"}),r=r&&e(this).validatorMe("checkSelect",{objEl:d,nameEl:"State"}),r=r&&e(this).validatorMe("checkRegexp",{objEl:n,pattern:/^[a-zа-яё0-9\s_]+$/i,sms:"Name may consist of a-z or а-Я, 0-9, underscores, spaces and must begin with a letter."}),r=r&&e(this).validatorMe("checkLength",{objEl:s,nameEl:"Date",min:10,max:0}),r=r&&e(this).validatorMe("checkRegexp",{objEl:s,pattern:/^[0-9]{1,2}\.[0-9]{1,2}\.[0-9]{4}$/,sms:"Invalid date format : DD.MM.YEAR"}),r=r&&e(this).validatorMe("equalOrLaterDate",{objEl:s,patternDate:/([\d]{1,2}).([\d]{1,2}).([\d]{4})/});var p={name:n.val(),priority:c.val(),state:d.val(),datepicker:s.val()},g=e.extend({id:"undefined"!=typeof o?o:""},p);return r&&200==e(this).ajaxReq({url:t,data:g,async:!1})&&("/add"!=t||a?"/upd"==t&&a&&i(a,p):l(p),creUpDialog.dialog("close")),r}function a(e,t){for(var a=1,i=t.get(0),l=i.length;a<l;a++)i[a].removeAttribute("selected"),e==i[a].getAttribute("value")&&i[a].setAttribute("selected","selected")}function i(e,t){for(k in t)e[k].text(t[k])}function l(t){var a=e("#task-list").children("tbody");a.prepend(e(this).createElementTable({elements:t}))}function o(e){e.find("#datepicker").prop("id","datepickerDialog").datepicker({minDate:new Date,dateFormat:"dd.mm.yy"})}function r(){e(this).validatorMe("tipsField",{defaultTypeText:d},!0)}var n=400,c=450,d=e(this).validatorMe().defaultTypeText;e("a.edit").on("click",function(i){i.preventDefault();var l=e(this).closest("tr"),d=l.data("task-id");l.addClass("yellowElement");var s={name:l.children("td:nth-child(2)"),priority:l.children("td:nth-child(3)"),state:l.children("td:nth-child(4)"),datepicker:l.children("td:nth-child(5)")};creUpDialog=e("#dialog-form").clone(!0).dialog({autoOpen:!1,height:n,width:c,modal:!0,buttons:{"Save a task":function(){t("/upd",s,d)},Cancel:function(){l.removeClass("yellowElement"),creUpDialog.dialog("close")}},title:"Update the task",open:function(){e("input[id=name]",creUpDialog).attr("value",s.name.text()),e("input[id=datepickerDialog]",creUpDialog).attr("value",s.datepicker.text()),a(s.priority.text(),e("select[id=priority]",creUpDialog)),a(s.state.text(),e("select[id=state]",creUpDialog))},close:function(){l.removeClass("yellowElement"),r(),creUpDialog.dialog("destroy")}}),o(creUpDialog),creUpDialog.dialog("open")}),e("#create-task").button().on("click",function(){creUpDialog=e("#dialog-form").clone(!0).dialog({autoOpen:!1,height:n,width:c,modal:!0,buttons:{"Create a task":function(){t("/add")},Cancel:function(){creUpDialog.dialog("close")}},close:function(){r(),creUpDialog.dialog("destroy")},title:"Create a new task"}),o(creUpDialog),creUpDialog.dialog("open")})}(jQuery);
$(function(){var t=$("#save-changes").button(),a=$("#sortable").sortable({placeholder:"ui-state-highlight",update:function(){t.button("enable")}});t.click(function(e){for(var n=0,l=a.children("tr[data-task-id]"),i=l.length,o={};n<i;n++)o[n]=l.eq(n).data("task-id");o.l=i,$(this).ajaxReq({url:"/sort",data:o}),t.button("disable"),e.preventDefault()})});
function wr_hours(e){time=new Date,time_sec=time.getSeconds(),time_min=time.getMinutes(),time_hours=time.getHours(),time_wr=(time_hours<10?"0":"")+time_hours,time_wr+=e,time_wr+=(time_min<10?"0":"")+time_min,time_wr=name_day[time.getDay()]+", "+time.getDate()+"."+time.getFullYear()+"\r\n"+time_wr,clock.text(time_wr)}clock=$("#clock");var a={0:function(){clock.datepicker("dialog")},1:function(){clock.datepicker("hide")}},b=-1;clock.button().click(function(){a[++b%2]()}),name_day=new Array("Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"),setTimeout(function e(t){wr_hours(t),setTimeout(e,1e3," "==t?":":" ")},1e3," ");